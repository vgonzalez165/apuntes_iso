![Carátula UT02](imgs/caratula_ut02.png)

## Contenidos

1. [Conceptos básicos de virtualización](01_conceptos_básicos.md)
2. [Tipos de máquinas virtuales](02_tipos_MV.md)
3. [Tipos de hipervisores](03_tipos_hipervisores.md)
4. [**Oracle VirtualBox**](04_virtualbox.md)
5. [Microsoft Hyper-V](05_hiper-v.md)


# 4.- ORACLE VIRTUALBOX


## 4.1.- Introducción a VirtualBox

**Oracle VM VirtualBox** es un software de virtualización para arquitecturas x86/AMD64 que en la actualidad pertenece a Oracle Corporation. Es un hipervisor de tipo 2, por lo que requiere de un sistema operativo base para ser instalado, teniendo soporte para Windows, GNU/Linux, Mac OS X, OS/2 Warp, Genode y Solaris/Open Solaris.


## 4.2.- Consideraciones previas

### 4.2.1.- Selección de directorio destino

Antes de proceder a crear la máquina virtual es conveniente seleccionar la carpeta donde se almacenarán por defecto las máquinas virtuales creadas, ya que por defecto las almacena en `C:` y puede consumir rápidamente todo el espacio disponible en el disco si se crean muchas máquinas virtuales, las cuales pueden llegar a ocupar varias decenas de gigabytes cada una.

Si se desea almacenar por defecto las máquinas virtuales en otro disco o partición hay que ir a *Archivo -> Preferencias -> General*, donde se mostrará la opción de escoger el directorio donde se ubicarán las máquinas.

Cada máquina virtual está compuesta por varios archivos, que se distinguen por su extensión. Estos archivos son:

- **Especificaciones de la máquina**. Este fichero tiene extensión `.vbox` y contiene las características que tiene la máquina virtual, como cantidad de memoria, procesador, ... Es un archivo XML, por lo que se podría abrir con cualquier editor de texto y ver su contenido. Por supuesto, no es aconsejable modificarlo manualmente en ningún caso.

```xml
<?xml version="1.0"?>
<!--
** DO NOT EDIT THIS FILE.
** If you make changes to this file while any VirtualBox related application
** is running, your changes will be overwritten later, without taking effect.
** Use VBoxManage or the VirtualBox Manager GUI to make changes.
-->
<VirtualBox xmlns="http://www.virtualbox.org/" version="1.15-windows">
  <Machine uuid="{5fd99477-4330-45ea-8efb-69e1f695da29}" name="W10" OSType="Windows10_64" snapshotFolder="Snapshots" lastStateChange="2021-09-17T05:05:10Z">
    <MediaRegistry>
      <HardDisks>
        <HardDisk uuid="{bb89abfa-8b3a-4cb3-8192-4720c2b059c8}" location="W10.vdi" format="VDI" type="Normal"/>
      </HardDisks>
      <DVDImages>
        <Image uuid="{fd54411c-d2a3-46df-838d-a135502c2a9d}" location="E:/00 - Im&#xE1;genes CDs/Windows/Windows 10/Windows 10 - Versi&#xF3;n 2020.iso"/>
        <Image uuid="{0d8f7ab7-9679-4279-a547-159c1e42a02a}" location="C:/Program Files/Oracle/VirtualBox/VBoxGuestAdditions.iso"/>
      </DVDImages>
    </MediaRegistry>
    <ExtraData>
      <ExtraDataItem name="GUI/LastGuestSizeHint" value="751,452"/>
      <ExtraDataItem name="GUI/LastNormalWindowPosition" value="0,23,640,522"/>
    </ExtraData>
    <Hardware>
      <CPU>
        <PAE enabled="false"/>
        <LongMode enabled="true"/>
        <HardwareVirtExLargePages enabled="true"/>
      </CPU>
      <Memory RAMSize="4096"/>
      <HID Pointing="USBTablet"/>
      ...
```

- **Copia de seguridad de la MV**. Es un fichero con extensión `vbox-prev` y simplemente es una copia del fichero anterior.
- **Discos virtuales**. Cada disco duro virtual que tenga la máquina tiene su propio fichero, con extensión `.vdi` (aunque VirtualBox también soporta discos virtuales de otras aplicaciones de virtualización). El que los discos virtuales tengan su propio fichero hace que sea muy sencillo moverlos de una máquina virtual a otra, de forma análoga a como haríamos con un disco físico.


### 4.2.2.- Instalación del Extensión Pack

Aunque con VirtualBox recién instalado ya se pueden crear máquinas virtuales y trabajar con ellas, hay un conjunto de herramientas denominado **Extension Pack** que se pueden instalar y aumentan la funcionalidad. Algunas de estas nuevas funciones que habría disponibles de instalarlas son:

- Funcionalidad **USB 2.0 y 3.0**
- **VirtualBox Remote Display Protocol (VRDP)**, que permite la conexión remota a las máquinas virtuales mediante RDP.
- **Intel PXE ROM**, para arrancar las máquinas virtuales desde la red.
- **Disk Encryption**, que permite el cifrado de los discos duros virtuales.
- **Host Webcam**, por si queremos utilizar desde la máquina virtual la webcam de la máquina física.

El proceso de instalación es muy sencillo, únicamente hay que ir al apartado de descargas de la web de [VirtualBox](https://www.virtualbox.org/wiki/Downloads), descargar el Extension Pack y seguir las instrucciones.


## 4.3.- Creación de una máquina virtual

El proceso de creación de una máquina virtual es bastante sencillo ya que únicamente hay que seguir las instrucciones que nos dará el asistente.

El primer paso será indicar el **nombre** que asignaremos a la máquina virtual y el **tipo y versión** de sistema operativo que instalaremos en ella. Es importante que tanto el tipo como la versión se correspondan con el sistema operativo que instalaremos, ya que VirtualBox optimizará la máquina virtual para dicho sistema operativo, por lo que una elección errónea puede suponer un mal funcionamiento de la máquina virtual.

A continuación, hay que seleccionar la **cantidad de memoria RAM** que se asignará a la máquina virtual.Hay que tener en cuenta que la memoria asignada a la MV se tomará de la máquina física, por lo que, si asignamos mucha memoria o abrimos simultáneamente muchas máquinas virtuales se corre el riesgo de que la máquina física ocupe toda la memoria y se colapse el sistema. Por defecto, sugiere una cantidad de memoria acorde a los requisitos del sistema operativo que se ha escogido en el paso anterior.

La siguiente ventana del asistente corresponde al **disco duro de la máquina virtual**, pudiendo escoger entre crear uno (la opción más habitual), conectar un disco virtual ya existente o no agregar ningún disco.

Al crear un disco se puede escoger entre dos tipos:

- **Tamaño fijo**: El tamaño del fichero `.vdi` será igual que el tamaño del disco virtual que hayamos escogido. Por ejemplo, si hemos creado un disco virtual de 25GB estaremos ocupando siempre 25GB del disco físico.
- **Reservado dinámicamente**: El tamaño del fichero `.vdi` será igual al tamaño que ocupen _los datos_ contenidos en el disco virtual. Por ejemplo, si en el disco virtual anterior solo tenemos ocupados 2 GB el tamaño del fichero .vdi será de 2 GB

Escoger un disco de tamaño reservado dinámicamente tiene la ventaja de que ahorra mucho espacio en disco, incluso se podría crear un disco virtual mucho mayor que el espacio disponible en el disco físico (siempre que los datos que contenga no excedan de este tamaño). Como inconveniente, el rendimiento es inferior al de los discos de tamaño fijo.

Y con esto ya estaría creada la máquina virtual, únicamente faltaría agregar un disco a la unidad óptica, que puede ser tanto un disco físico como una imagen ISO.


## 4.4.- Configuración de la máquina virtual

Una vez creada una máquina virtual es posible editar su configuración mediante la opción *Preferencias*. Las opciones de configuración son:


### 4.4.1.- General

![General - Básico](imgs/VirtualBox_general_básico.png)

En la pestaña **Básico** se puede cambiar el nombre que le hemos asignado a la máquina virtual. Asimismo, también se puede modificar el **tipo** y la **versión** del sistema operativo que contendrá la máquina virtual.




### 4.4.2.- Sistema

Aquí hay varias opciones relativas a las características hardware de la máquina virtual, entre las que destacan:

- **Memoria base**: la cantidad de memoria que se asignará a la máquina virtual. 
- **Opción de arranque**: de forma análoga a como se hace en una máquina física, aquí se puede indicar el orden en que se seleccionarán los dispositivos para arrancar la máquina virtual.
- **Procesadores**: aquí se indica el número de CPUs virtuales que se asignarán a la MV. Al igual que pasaba con la memoria RAM, tiene correspondencia con los núcleos que tenga la máquina física (si la máquina física tiene Hyperthreading cada núcleo físico contará por dos), por lo que si asignamos demasiados puede que la máquina física se quede sin recursos.
- **Límite de ejecución**: permite limitar el uso de cada CPU asignada a la máquina virtual.


### 4.4.3.- Pantalla



### 4.4.4.- Almacenamiento


### 4.4.5.- Audio


### 4.4.6.- Red


## 4.5.- Adaptadores de red en VirtualBox

Un aspecto importante en la configuración de cualquier máquina virtual es la gestión de los adaptadores de red, ya que la elección de uno y otro tipo de adaptador determinará con qué otras máquinas virtuales e incluso equipos físicos podrá tener conectividad la máquina virtual.

En VirtualBox se pueden añadir hasta 4 adaptadores de red, que la máquina virtual verá como si fueran tarjetas de red. Se pueden añadir nuevos adaptadores desde el cuadro de diálogo *Configuración* e la máquina virtual siempre y cuando ésta se encuentre apagada.

También hay que tener en cuenta que es posible que los diferentes adaptadores de red tengan diferentes modos, por ejemplo, se podría añadir un adaptador en *modo NAT* que proporcione acceso a Internet a la máquina y otro en modo *red interna* que comunique la máquina virtual con otras máquinas virtuales.

![Adaptadores de red en VirtualBox](imgs/vbox_adaptadores.png)

Los modos de red disponibles son los siguientes:

### 4.5.1.- Modo NAT

Es el modo más básico y su objetivo es proporcionar acceso a Internet a la máquina virtual de forma totalmente transparente para el usuario.

VirtualBox se encargará de otorgar una IP dinámica a la máquina virtual mediante DHCP y de enrutar todos los paquetes hacia Internet. La máquina virtual podrá acceder a cualquier dirección de Internet, pero estará totalmente aislada de cualquier otro equipo o máquina virtual.

### 4.5.2.- Adaptador puente

En el modo **Adaptador puente** la máquina virtual se comportará con el adaptador de red exactamente igual a como lo haría una máquina física. Es decir, la máquina virtual accederá directamente a la red física, y por tanto es como si estuviera conectado directamente a la red local.

De esta forma, si en la red física hubiera un servidor DHCP la máquina virtual podría obtener su dirección IP de este servidor, pero no si no lo hubiera habría que configurar la IP estática con los parámetros de la red física (máscara, puerta de enlace, ...)


### 4.5.3.- Red interna

Hay ocasiones en que se trabaja con varias máquinas virtuales y se desea que tengan conectividad entre ellas. En ese caso es posible seleccionar el modo **red interna** que crea una red virtual a la que se interconectan las máquinas. Hay que tener varias cosas en cuenta:

- Al seleccionar *red interna* se muestra la opción de elegir un nombre. Todos los equipos que se encuentran en una red con el mismo nombre se podrán ver entre ellos. Si se desea tener varias redes independientes entre sí simplemente hay que asignarles nombres diferentes.
- Las máquinas solo pueden ver a otras máquinas que se encuentren en la misma red interna, ni la máquina física, ni otras máquinas físicas ni direcciones de Internet.
- VirtualBox no asigna IPs dinámicas a los adaptadores en modo *red interna*, por lo que será necesario asignar una IP estática manualmente si se desea que haya interconectividad entre las máquinas.


### 4.5.4.- Adaptador solo-anfitrión

El **adaptador en modo solo-anfitrión** se puede considerar como una *red interna* a la que también se añade la máquina física. Para ello, VirtualBox creará un adaptador virtual en la máquina física que tendrá una IP en el mismo rango que los adaptadores en modo *solo-anfitrión* de las máquinas virtuales.

Si se ejecuta el comando `ipconfig` en la línea de comandos se puede ver este adaptador virtual al que suele asignar el nombre `Virtual Host-Only Network`

```powershell
PS C:\> ipconfig

Configuración IP de Windows

Adaptador de Ethernet VirtualBox Host-Only Network:

   Sufijo DNS específico para la conexión. . :
   Vínculo: dirección IPv6 local. . . : fe80::50a5:54ad:4f94:d7df%4
   Dirección IPv4. . . . . . . . . . . . . . : 192.168.56.1
   Máscara de subred . . . . . . . . . . . . : 255.255.255.0
   Puerta de enlace predeterminada . . . . . :
```

Una diferencia importante de este modo respecto al modo *red interna* es que VirtualBox asigna una **IP dinámica** a los equipos que tengan este tipo de adaptador, asegurándose de que se encuentre en el mismo rango que el adaptador virtual que ha creado en el equipo físico.

En este modo no hay conectividad con Internet ni con otros equipos físicos.

Es posible tener diferentes redes en modo *solo-anfitrión*, pero es necesario configurarlas primero yendo a *Herramientas -> Red* y seleccionando crear. Al hacerlo, se creará un nuevo adaptador virtual en el equipo físico y deberemos indicar lo siguiente:

- IP y máscara que tendrá el adaptador virtual del equipo físico
- Si habrá servidor DHCP que otorgue direcciones dinámicas a todas las máquinas virtuales que tengan este adaptador
- El rango de direcciones IP que otorgará el servidor DHCP.

![Creación de redes solo-anfitrión](imgs/virtualbox_solo_anfitrión.png)

### 4.5.5.- Red NAT

El modo **red NAT** combina las ventajas de la red interna (que permite la interconexión entre máquinas virtuales) y el modo NAT (que permite interconexión con Internet).

De forma análoga al modo *solo-anfitrión*, es posible crear diferentes redes en este modo aisladas entre sí. Para crearlas hay que ir al menú *Archivo -> Preferencias -> Red* y hacer click en el icono *Crear*. Hay que indicar la dirección IP y máscara de la red y si habrá un servidor DHCP o hay que configurar la IP de las máquinas virtuales como estática.




![Medios virtuales](imgs/vbox_medios_virtuales.png)


*** 

[Volver al índice](index_UT02.md)